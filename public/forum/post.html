<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/headerForum.css">
    <link rel="stylesheet" href="../css/footer.css">
    <link rel="stylesheet" href="../css/post.css">
    <script src="../js/sessao.js"></script>
</head>

<body onload="atualizarPost()">
    <header class="header_container">
        <section class="section_header container">
            <div class="img_container">
                <img src="../assets/img/voleibol_png_branca.png" alt="">
            </div>
            <div class="perfil_container">
                <span id="user_name"></span>
                <div class="foto_perfil">
                    <img src="../assets/img/user_profiel_image.png" alt="">
                </div>
                <span class="menu_toggle">
                    <i onclick="dropDownMenuToggle()" class="fa-solid fa-sort-down"></i>
                    <div id="dropDownMenu" class="dropdow_menu">
                        <span onclick="limparSessao()">Sair <i class="fa-solid fa-right-from-bracket"></i></span>
                    </div>
                </span>
            </div>
        </section>
    </header>
    <section class="nav_section">
        <div class="nav_content container">
            <nav class=nav_menu>
                <span class="item_menu">Feed</span>
                <span class="item_menu">Notícias</span>
            </nav>
            <div class="pesquisa_container">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" placeholder="Pesquisar...">
            </div>
        </div>
    </section>

    <main>
        <div class="container">
            <div class="post_container">
                <div id="post_content_id" class="post_content">

                </div>

                <div id="comentarios_container" class="user_post_comentarios">
                    <h1>Comentários</h1>

                </div>

                <div class="comentar_container">
                    <div class="comentar_content">
                        <div class="foto_perfil">
                            <img src="../assets/img/user_profiel_image.png" alt="">
                        </div>
                        <textarea id="input_comentario" placeholder="Deixe aqui seu comentário"></textarea>
                    </div>
                    <button>COMENTAR</button>
                </div>
            </div>
        </div>
        </div>
    </main>

    <footer class="footer_container scroll_content">
        <div class="top_footer">
            <div class="img_container_footer ">
                <img src="../assets/img/voleibol_png_branca.png" alt="">
            </div>
            <ul class="list_footer">
                <li class="title_list">Navegação</li>
                <li>História</li>
                <li>Características</li>
                <li>Sobre mim</li>
            </ul>
            <ul class="list_footer">
                <li class="title_list">Contato</li>
                <li>(+55) 0000-0000</li>
                <li>(+55) 3691-0000</li>
                <li>nome.sobrenome@gmail.com</li>
            </ul>
            <div class="list_icon">
                <p class="title_list">Redes Sociais</p>
                <div class="flex_icon">
                    <i class="fa-brands fa-instagram"></i>
                    <i class="fa-brands fa-whatsapp"></i>
                    <i class="fa-brands fa-facebook"></i>
                </div>
            </div>
        </div>
        <div class="bottom_footer">
            <p>©2024 - Vôlei como estilo de vida</p>
        </div>
    </footer>
</body>

</html>

<script src="https://kit.fontawesome.com/d94da5d75d.js" crossorigin="anonymous"></script>
<script>
    user_name.innerHTML = sessionStorage.getItem('NOME_USUARIO')

    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    console.log(id)
    let dadosPostagens = '';
    let comentarios = '';

    function formatarTempoPostagem(dataHora) {
        let dataPostagem = '';
        const datetimeString = dataHora;
        let startDate = new Date(datetimeString);
        let currentDate = new Date();
        let differenceInMilliseconds = currentDate - startDate;

        let seconds = Math.floor(differenceInMilliseconds / 1000);
        let minutes = Math.floor(seconds / 60);
        let hours = Math.floor(minutes / 60);
        let days = Math.floor(hours / 24);

        seconds %= 60;
        minutes %= 60;
        hours %= 24;

        if (days > 0) {
            dataPostagem = `${days} d`;
        } else if (hours > 0) {
            dataPostagem = `${hours} h`
        } else if (minutes > 0) {
            dataPostagem = `${minutes} min`
        } else {
            dataPostagem = `${seconds} s`
        }

        return dataPostagem;

    }

    function atualizarPost() {
        fetch(`/postagens/pegar/${id}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        console.log(resposta)
                        dadosPostagens = resposta.postagem[0];
                        comentarios = resposta.comentarios;
                        console.log(dadosPostagens)
                        console.log(comentarios)


                        post_content_id.innerHTML = `
                    <div class="header_post">
                        <div class="user_post_info">
                            <div class="foto_perfil">
                                <img src="../assets/img/user_profiel_image.png" alt="">
                            </div>
                            <h3>${dadosPostagens.nome}</h3>
                            <i class="fa-solid fa-circle"></i>
                            <span>${formatarTempoPostagem(dadosPostagens.dataHora)}</span>
                        </div>
                        <i class="fa-solid fa-heart like"></i>
                    </div>
                    <div class="user_post_content">
                        <h1>${dadosPostagens.assunto}</h1>
                        <p>${dadosPostagens.descricao}</p>
                    </div>
                    <div class="user_post_status">
                        <span class="status_item">
                            <i class="fa-solid fa-message msg"></i>
                            ${dadosPostagens.qtdComentarios} Comentários
                        </span>
                        <span class="status_item">
                            <i class="fa-solid fa-heart like"></i>
                            ${dadosPostagens.qtdCurtidas} Curtidas
                        </span>
                        <span class="status_item">
                            <i class="fa-solid fa-eye view"></i>
                            ${dadosPostagens.qtdVisualizacoes} Visualizações
                        </span>
                    </div>
            `

            comentarios.map(comentario => {
                comentarios_container.innerHTML += `
                <div class="comentario_container">
                        <div class="user_post_info">
                            <div class="foto_perfil">
                                <img src="../assets/img/user_profiel_image.png" alt="">
                            </div>
                            <h3>${comentario.nome}</h3>
                            <i class="fa-solid fa-circle"></i>
                            <span>${formatarTempoPostagem(comentario.dataHora)}</span>
                        </div>
                        <p>${comentario.mensagem}</p>
                    </div>
                `
            })


                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });


    }

    let dropdowMenuOpen = false;
    function dropDownMenuToggle() {
        if (dropdowMenuOpen) {
            dropDownMenu.style.display = 'none'

        } else {
            dropDownMenu.style.display = 'flex'
        }
        dropdowMenuOpen = !dropdowMenuOpen;
    }

</script>